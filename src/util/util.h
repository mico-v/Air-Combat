/**
 * @file util.h
 * @brief å·¥å…·å‡½æ•°å£°æ˜æ–‡ä»¶
 * 
 * è¿™ä¸ªæ–‡ä»¶å£°æ˜äº†æ¸¸æˆä¸­å¸¸ç”¨çš„å·¥å…·å‡½æ•°ï¼ŒåŒ…æ‹¬ï¼š
 * - æ•°å­¦è¿ç®—ï¼ˆå‘é‡ã€éšæœºæ•°ç­‰ï¼‰
 * - ç¢°æ’æ£€æµ‹
 * - å…¶ä»–è¾…åŠ©å‡½æ•°
 * 
 * ğŸ’¡ åˆå­¦è€…æç¤ºï¼š
 * è¿™ä¸ªæ–‡ä»¶åªæœ‰å‡½æ•°çš„"å£°æ˜"ï¼ˆå‘Šè¯‰ç¼–è¯‘å™¨å‡½æ•°é•¿ä»€ä¹ˆæ ·ï¼‰ï¼Œ
 * å®é™…çš„å‡½æ•°"å®ç°"ï¼ˆå…·ä½“æ€ä¹ˆåšï¼‰åœ¨ util.cpp æ–‡ä»¶ä¸­ã€‚
 */

#pragma once

#include "type.h"
#include <cmath>
#include <tchar.h>

/* ============================================================================
 * æ•°å­¦å·¥å…·å‡½æ•°
 * ============================================================================
 */

/**
 * @brief è®¡ç®—å‘é‡çš„é•¿åº¦
 * 
 * @param v è¦è®¡ç®—é•¿åº¦çš„å‘é‡
 * @return å‘é‡çš„é•¿åº¦ï¼ˆæ€»æ˜¯éè´Ÿæ•°ï¼‰
 * 
 * è®¡ç®—å…¬å¼ï¼šlength = âˆš(xÂ² + yÂ²)
 * 
 * ä½¿ç”¨ç¤ºä¾‹ï¼š
 * ```cpp
 * Vector2 v = {3.0, 4.0};
 * double len = Length(v);  // len = 5.0
 * ```
 */
double Length(Vector2 v);

/**
 * @brief å½’ä¸€åŒ–å‘é‡ï¼ˆå˜æˆé•¿åº¦ä¸º 1 çš„å‘é‡ï¼‰
 * 
 * @param v è¦å½’ä¸€åŒ–çš„å‘é‡
 * @return å½’ä¸€åŒ–åçš„å‘é‡ï¼ˆé•¿åº¦ä¸º 1ï¼Œæ–¹å‘ä¸å˜ï¼‰
 * 
 * å¦‚æœè¾“å…¥å‘é‡é•¿åº¦ä¸º 0ï¼Œè¿”å› (0, 0)
 * 
 * ç”¨é€”ï¼š
 * - ä¿è¯æ‰€æœ‰æ–¹å‘çš„ç§»åŠ¨é€Ÿåº¦ä¸€è‡´
 * - è·å–çº¯æ–¹å‘å‘é‡ï¼ˆä¸å…³å¿ƒå¤§å°ï¼‰
 * 
 * ä½¿ç”¨ç¤ºä¾‹ï¼š
 * ```cpp
 * // WASD ç§»åŠ¨
 * Vector2 direction = {0, 0};
 * if (GetKeyDown('W')) direction.y -= 1;
 * if (GetKeyDown('D')) direction.x += 1;
 * 
 * // å¦‚æœåŒæ—¶æŒ‰ W å’Œ Dï¼ˆå³ä¸Šæ–¹ï¼‰ï¼Œé•¿åº¦æ˜¯ âˆš2
 * // å½’ä¸€åŒ–åé•¿åº¦å˜æˆ 1ï¼Œä½†æ–¹å‘ä¸å˜
 * direction = Normalize(direction);
 * 
 * // ç°åœ¨æ‰€æœ‰æ–¹å‘é€Ÿåº¦ä¸€è‡´
 * player->x += direction.x * speed * deltaTime;
 * ```
 */
Vector2 Normalize(Vector2 v);

/**
 * @brief å‘é‡ç‚¹ä¹˜
 * 
 * @param v1 ç¬¬ä¸€ä¸ªå‘é‡
 * @param v2 ç¬¬äºŒä¸ªå‘é‡
 * @return ç‚¹ä¹˜ç»“æœ
 * 
 * è®¡ç®—å…¬å¼ï¼šresult = v1.x * v2.x + v1.y * v2.y
 * 
 * ç”¨é€”ï¼š
 * - åˆ¤æ–­ä¸¤ä¸ªå‘é‡æ˜¯å¦å‚ç›´ï¼ˆç‚¹ä¹˜ä¸º 0ï¼‰
 * - è®¡ç®—æŠ•å½±é•¿åº¦
 * - åˆ¤æ–­æ–¹å‘ç›¸ä¼¼åº¦
 */
double Dot(Vector2 v1, Vector2 v2);

/**
 * @brief è®¡ç®—ä¸¤ç‚¹ä¹‹é—´çš„è·ç¦»
 * 
 * @param p1 ç¬¬ä¸€ä¸ªç‚¹
 * @param p2 ç¬¬äºŒä¸ªç‚¹
 * @return ä¸¤ç‚¹ä¹‹é—´çš„è·ç¦»
 * 
 * è®¡ç®—å…¬å¼ï¼šdistance = âˆš((x2-x1)Â² + (y2-y1)Â²)
 * 
 * ä½¿ç”¨ç¤ºä¾‹ï¼š
 * ```cpp
 * Vector2 playerPos = {100, 200};
 * Vector2 enemyPos = {150, 250};
 * double dist = Distance(playerPos, enemyPos);
 * 
 * if (dist < 100)
 * {
 *     // ç©å®¶å’Œæ•Œäººè·ç¦»å°äº 100ï¼Œè§¦å‘æŸäº›äº‹ä»¶
 * }
 * ```
 */
double Distance(Vector2 p1, Vector2 p2);

/**
 * @brief é™åˆ¶æ•°å€¼åœ¨æŒ‡å®šèŒƒå›´å†…
 * 
 * @param value è¦é™åˆ¶çš„å€¼
 * @param min æœ€å°å€¼
 * @param max æœ€å¤§å€¼
 * @return é™åˆ¶åçš„å€¼
 * 
 * å¦‚æœ value < minï¼Œè¿”å› min
 * å¦‚æœ value > maxï¼Œè¿”å› max
 * å¦åˆ™è¿”å› value
 * 
 * ä½¿ç”¨ç¤ºä¾‹ï¼š
 * ```cpp
 * // é™åˆ¶ç©å®¶åœ¨å±å¹•å†…
 * player->x = Clamp(player->x, 0, GAME_WIDTH - player->width);
 * player->y = Clamp(player->y, 0, GAME_HEIGHT - player->height);
 * ```
 */
double Clamp(double value, double min, double max);

/**
 * @brief çº¿æ€§æ’å€¼
 * 
 * @param a èµ·å§‹å€¼
 * @param b ç»“æŸå€¼
 * @param t æ’å€¼å‚æ•°ï¼ˆ0 åˆ° 1ï¼‰
 * @return æ’å€¼ç»“æœ
 * 
 * è®¡ç®—å…¬å¼ï¼šresult = a + (b - a) * t
 * å½“ t = 0 æ—¶ï¼Œè¿”å› a
 * å½“ t = 1 æ—¶ï¼Œè¿”å› b
 * å½“ t = 0.5 æ—¶ï¼Œè¿”å› a å’Œ b çš„ä¸­é—´å€¼
 * 
 * ç”¨é€”ï¼š
 * - å¹³æ»‘è¿‡æ¸¡
 * - åŠ¨ç”»æ•ˆæœ
 * - ç›¸æœºè·Ÿéš
 */
double Lerp(double a, double b, double t);

/* ============================================================================
 * éšæœºæ•°å·¥å…·å‡½æ•°
 * ============================================================================
 */

/**
 * @brief ç”ŸæˆæŒ‡å®šèŒƒå›´å†…çš„éšæœºæ•´æ•°
 * 
 * @param min æœ€å°å€¼ï¼ˆåŒ…å«ï¼‰
 * @param max æœ€å¤§å€¼ï¼ˆåŒ…å«ï¼‰
 * @return [min, max] èŒƒå›´å†…çš„éšæœºæ•´æ•°
 * 
 * ä½¿ç”¨ç¤ºä¾‹ï¼š
 * ```cpp
 * // ç”Ÿæˆ 1-6 çš„éšæœºæ•°ï¼ˆæ¨¡æ‹Ÿéª°å­ï¼‰
 * int dice = GetRandomInt(1, 6);
 * 
 * // éšæœºé€‰æ‹©æ•Œäººç±»å‹ï¼ˆ0, 1, 2ï¼‰
 * int enemyType = GetRandomInt(0, 2);
 * ```
 */
int GetRandomInt(int min, int max);

/**
 * @brief ç”ŸæˆæŒ‡å®šèŒƒå›´å†…çš„éšæœºå°æ•°
 * 
 * @param min æœ€å°å€¼
 * @param max æœ€å¤§å€¼
 * @return [min, max] èŒƒå›´å†…çš„éšæœºå°æ•°
 * 
 * ä½¿ç”¨ç¤ºä¾‹ï¼š
 * ```cpp
 * // åœ¨å±å¹•å®½åº¦èŒƒå›´å†…éšæœºç”Ÿæˆ X åæ ‡
 * double randomX = GetRandomDouble(0, GAME_WIDTH - ENEMY_WIDTH);
 * 
 * // éšæœºé€Ÿåº¦ï¼ˆ200-300ï¼‰
 * double speed = GetRandomDouble(200, 300);
 * ```
 */
double GetRandomDouble(double min, double max);

/**
 * @brief ç”Ÿæˆéšæœºå¸ƒå°”å€¼
 * 
 * @return true æˆ– falseï¼ˆå„ 50% æ¦‚ç‡ï¼‰
 * 
 * ä½¿ç”¨ç¤ºä¾‹ï¼š
 * ```cpp
 * // éšæœºå†³å®šæ•Œäººçš„ç§»åŠ¨æ–¹å‘
 * if (GetRandomBool())
 * {
 *     enemy->moveLeft = true;
 * }
 * else
 * {
 *     enemy->moveLeft = false;
 * }
 * ```
 */
bool GetRandomBool();

/* ============================================================================
 * ç¢°æ’æ£€æµ‹å‡½æ•°
 * ============================================================================
 */

/**
 * @brief æ£€æµ‹ä¸¤ä¸ªçŸ©å½¢æ˜¯å¦ç¢°æ’
 * 
 * @param rect1 ç¬¬ä¸€ä¸ªçŸ©å½¢
 * @param rect2 ç¬¬äºŒä¸ªçŸ©å½¢
 * @return true è¡¨ç¤ºç¢°æ’ï¼Œfalse è¡¨ç¤ºæœªç¢°æ’
 * 
 * ç¢°æ’æ¡ä»¶ï¼š
 * - rect1 çš„å³è¾¹ > rect2 çš„å·¦è¾¹
 * - rect1 çš„å·¦è¾¹ < rect2 çš„å³è¾¹
 * - rect1 çš„ä¸‹è¾¹ > rect2 çš„ä¸Šè¾¹
 * - rect1 çš„ä¸Šè¾¹ < rect2 çš„ä¸‹è¾¹
 * 
 * ä½¿ç”¨ç¤ºä¾‹ï¼š
 * ```cpp
 * // æ£€æµ‹ç©å®¶ä¸æ•Œäººçš„ç¢°æ’
 * Rect playerRect = {player->x, player->x + player->width,
 *                    player->y, player->y + player->height};
 * Rect enemyRect = {enemy->x, enemy->x + enemy->width,
 *                   enemy->y, enemy->y + enemy->height};
 * 
 * if (IsRectRectCollision(playerRect, enemyRect))
 * {
 *     // å‘ç”Ÿç¢°æ’ï¼
 *     player->health--;
 * }
 * ```
 */
bool IsRectRectCollision(Rect rect1, Rect rect2);

/**
 * @brief æ£€æµ‹çŸ©å½¢ä¸åœ†å½¢æ˜¯å¦ç¢°æ’
 * 
 * @param rect çŸ©å½¢
 * @param circle åœ†å½¢
 * @return true è¡¨ç¤ºç¢°æ’ï¼Œfalse è¡¨ç¤ºæœªç¢°æ’
 * 
 * ç®—æ³•ï¼š
 * 1. æ‰¾åˆ°çŸ©å½¢ä¸Šè·ç¦»åœ†å¿ƒæœ€è¿‘çš„ç‚¹
 * 2. è®¡ç®—è¿™ä¸ªç‚¹åˆ°åœ†å¿ƒçš„è·ç¦»
 * 3. å¦‚æœè·ç¦»å°äºåŠå¾„ï¼Œåˆ™ç¢°æ’
 * 
 * ä½¿ç”¨ç¤ºä¾‹ï¼š
 * ```cpp
 * // æ£€æµ‹å­å¼¹ï¼ˆåœ†å½¢ï¼‰ä¸æ•Œäººï¼ˆçŸ©å½¢ï¼‰çš„ç¢°æ’
 * Rect enemyRect = {...};
 * Circle bulletCircle = {bullet->position, bullet->radius};
 * 
 * if (IsRectCircleCollision(enemyRect, bulletCircle))
 * {
 *     // å­å¼¹å‡»ä¸­æ•Œäººï¼
 *     enemy->health -= bullet->damage;
 * }
 * ```
 */
bool IsRectCircleCollision(Rect rect, Circle circle);

/**
 * @brief æ£€æµ‹ä¸¤ä¸ªåœ†å½¢æ˜¯å¦ç¢°æ’
 * 
 * @param circle1 ç¬¬ä¸€ä¸ªåœ†å½¢
 * @param circle2 ç¬¬äºŒä¸ªåœ†å½¢
 * @return true è¡¨ç¤ºç¢°æ’ï¼Œfalse è¡¨ç¤ºæœªç¢°æ’
 * 
 * ç¢°æ’æ¡ä»¶ï¼š
 * ä¸¤ä¸ªåœ†å¿ƒä¹‹é—´çš„è·ç¦» <= ä¸¤ä¸ªåŠå¾„ä¹‹å’Œ
 * 
 * ä½¿ç”¨ç¤ºä¾‹ï¼š
 * ```cpp
 * Circle bullet1 = {pos1, 5};
 * Circle bullet2 = {pos2, 5};
 * 
 * if (IsCircleCircleCollision(bullet1, bullet2))
 * {
 *     // ä¸¤é¢—å­å¼¹ç›¸æ’ï¼ˆè™½ç„¶è¿™åœ¨æ¸¸æˆä¸­ä¸å¸¸è§ï¼‰
 * }
 * ```
 */
bool IsCircleCircleCollision(Circle circle1, Circle circle2);

/**
 * @brief æ£€æµ‹ç‚¹æ˜¯å¦åœ¨çŸ©å½¢å†…
 * 
 * @param point ç‚¹çš„åæ ‡
 * @param rect çŸ©å½¢
 * @return true è¡¨ç¤ºç‚¹åœ¨çŸ©å½¢å†…ï¼Œfalse è¡¨ç¤ºä¸åœ¨
 * 
 * ä½¿ç”¨ç¤ºä¾‹ï¼š
 * ```cpp
 * Vector2 mousePos = {GetMouseX(), GetMouseY()};
 * Rect buttonRect = {100, 300, 200, 300};
 * 
 * if (IsPointInRect(mousePos, buttonRect))
 * {
 *     // é¼ æ ‡åœ¨æŒ‰é’®ä¸Š
 * }
 * ```
 */
bool IsPointInRect(Vector2 point, Rect rect);

/**
 * @brief æ£€æµ‹ç‚¹æ˜¯å¦åœ¨åœ†å½¢å†…
 * 
 * @param point ç‚¹çš„åæ ‡
 * @param circle åœ†å½¢
 * @return true è¡¨ç¤ºç‚¹åœ¨åœ†å½¢å†…ï¼Œfalse è¡¨ç¤ºä¸åœ¨
 * 
 * åˆ¤æ–­æ–¹æ³•ï¼šç‚¹åˆ°åœ†å¿ƒçš„è·ç¦» <= åŠå¾„
 */
bool IsPointInCircle(Vector2 point, Circle circle);

/* ============================================================================
 * åæ ‡è½¬æ¢å‡½æ•°
 * ============================================================================
 */

/**
 * @brief ä»æ¸¸æˆå¯¹è±¡åˆ›å»ºç¢°æ’çŸ©å½¢
 * 
 * @param position å¯¹è±¡ä½ç½®ï¼ˆå·¦ä¸Šè§’ï¼‰
 * @param width å¯¹è±¡å®½åº¦
 * @param height å¯¹è±¡é«˜åº¦
 * @return ç¢°æ’çŸ©å½¢
 * 
 * è¿™æ˜¯ä¸€ä¸ªä¾¿æ·å‡½æ•°ï¼Œå¿«é€Ÿä»æ¸¸æˆå¯¹è±¡åˆ›å»ºç¢°æ’çŸ©å½¢
 * 
 * ä½¿ç”¨ç¤ºä¾‹ï¼š
 * ```cpp
 * Rect playerRect = CreateRect(player->position, player->width, player->height);
 * ```
 */
Rect CreateRect(Vector2 position, double width, double height);

/**
 * @brief ä»æ¸¸æˆå¯¹è±¡åˆ›å»ºç¢°æ’åœ†å½¢
 * 
 * @param center åœ†å¿ƒåæ ‡
 * @param radius åŠå¾„
 * @return ç¢°æ’åœ†å½¢
 */
Circle CreateCircle(Vector2 center, double radius);

/* ============================================================================
 * è°ƒè¯•è¾…åŠ©å‡½æ•°
 * ============================================================================
 */

/**
 * @brief è¾“å‡ºæ—¥å¿—ä¿¡æ¯åˆ°çŠ¶æ€æ 
 * 
 * @param statusBarIndex çŠ¶æ€æ ç´¢å¼•ï¼ˆ0 æˆ– 1ï¼‰
 * @param format æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼ˆç±»ä¼¼ printfï¼‰
 * @param ... å¯å˜å‚æ•°
 * 
 * ä½¿ç”¨ç¤ºä¾‹ï¼š
 * ```cpp
 * Log(1, TEXT("ç©å®¶ä½ç½®: x=%f, y=%f"), player->x, player->y);
 * Log(1, TEXT("æ•Œäººæ•°é‡: %d"), enemies.size());
 * Log(1, TEXT("å½“å‰ FPS: %d"), fps);
 * ```
 * 
 * ğŸ’¡ æç¤ºï¼š
 * - çŠ¶æ€æ  0 é€šå¸¸ç”¨äºæ˜¾ç¤º FPS
 * - çŠ¶æ€æ  1 ç”¨äºæ˜¾ç¤ºå…¶ä»–ä¿¡æ¯
 * - å­—ç¬¦ä¸²å¿…é¡»ä½¿ç”¨ TEXT å®åŒ…å›´
 */
void Log(int statusBarIndex, const TCHAR* format, ...);

/* ============================================================================
 * å­—ç¬¦ä¸²å¤„ç†å‡½æ•°
 * ============================================================================
 */

/**
 * @brief æ ¼å¼åŒ–è¾“å‡ºåˆ°å­—ç¬¦ä¸²
 * 
 * @param buffer è¾“å‡ºç¼“å†²åŒº
 * @param bufferSize ç¼“å†²åŒºå¤§å°
 * @param format æ ¼å¼åŒ–å­—ç¬¦ä¸²
 * @param ... å¯å˜å‚æ•°
 * 
 * ä½¿ç”¨ç¤ºä¾‹ï¼š
 * ```cpp
 * TCHAR buffer[128];
 * FormatString(buffer, 128, TEXT("åˆ†æ•°: %d, ç”Ÿå‘½: %d"), 
 *              score, health);
 * 
 * // ç„¶åå¯ä»¥ç”¨ DrawText æ˜¾ç¤º
 * DrawText(hdc, buffer, -1, &rect, DT_CENTER);
 * ```
 */
void FormatString(TCHAR* buffer, int bufferSize, const TCHAR* format, ...);

/* ============================================================================
 * ä½¿ç”¨å»ºè®®
 * ============================================================================
 * 
 * 1. ä¼˜å…ˆä½¿ç”¨è¿™äº›å·¥å…·å‡½æ•°ï¼Œè€Œä¸æ˜¯è‡ªå·±é‡æ–°å®ç°
 *    âœ… å¥½ï¼šdouble len = Length(v);
 *    âŒ å·®ï¼šdouble len = sqrt(v.x*v.x + v.y*v.y);
 * 
 * 2. ç¢°æ’æ£€æµ‹æ—¶é€‰æ‹©åˆé€‚çš„å½¢çŠ¶
 *    - çŸ©å½¢ï¼šé€‚åˆæ–¹å½¢ç‰©ä½“ï¼ˆé£æœºã€æ•Œäººï¼‰
 *    - åœ†å½¢ï¼šé€‚åˆåœ†å½¢ç‰©ä½“ï¼ˆå­å¼¹ã€çˆ†ç‚¸èŒƒå›´ï¼‰
 *    - ç‚¹ï¼šé€‚åˆç²¾ç¡®æ£€æµ‹ï¼ˆé¼ æ ‡ç‚¹å‡»ï¼‰
 * 
 * 3. æ€§èƒ½è€ƒè™‘
 *    - Distance å‡½æ•°æ¶‰åŠå¼€æ–¹ï¼Œæ¯”è¾ƒæ…¢
 *    - å¦‚æœåªæ˜¯æ¯”è¾ƒè·ç¦»ï¼Œå¯ä»¥æ¯”è¾ƒè·ç¦»çš„å¹³æ–¹ï¼ˆé¿å…å¼€æ–¹ï¼‰
 *    - ç¤ºä¾‹ï¼š
 *      double distSq = (dx*dx + dy*dy);  // è·ç¦»çš„å¹³æ–¹
 *      if (distSq < range*range)  // æ¯”è¾ƒå¹³æ–¹å€¼
 * 
 * 4. è°ƒè¯•æ—¶å–„ç”¨ Log å‡½æ•°
 *    - è¾“å‡ºå…³é”®å˜é‡çš„å€¼
 *    - æ£€æŸ¥å‡½æ•°æ˜¯å¦è¢«è°ƒç”¨
 *    - éªŒè¯é€»è¾‘æ˜¯å¦æ­£ç¡®
 * 
 * ============================================================================
 */
