/**
 * @file keyboard.cpp
 * @brief ÈîÆÁõòËæìÂÖ•Á≥ªÁªüÂÆûÁé∞Êñá‰ª∂
 * 
 * Ëøô‰∏™Êñá‰ª∂ÂÆûÁé∞‰∫ÜÈîÆÁõòËæìÂÖ•ÁöÑÁä∂ÊÄÅÁÆ°ÁêÜ„ÄÇ
 * 
 * üí° Ê†∏ÂøÉÊÄùÊÉ≥Ôºö
 * ‰ΩøÁî®‰∏Ä‰∏™Â∏ÉÂ∞îÊï∞ÁªÑÂ≠òÂÇ®ÊâÄÊúâÊåâÈîÆÁöÑÁä∂ÊÄÅÔºåÂú® Win32 Ê∂àÊÅØÂ§ÑÁêÜ‰∏≠Êõ¥Êñ∞Áä∂ÊÄÅÔºå
 * Âú®Ê∏∏ÊàèÈÄªËæë‰∏≠Êü•ËØ¢Áä∂ÊÄÅ„ÄÇ
 */

#include "keyboard.h"

/* ============================================================================
 * ÂÜÖÈÉ®Áä∂ÊÄÅÂ≠òÂÇ®
 * ============================================================================
 */

/**
 * @brief ÊåâÈîÆÁä∂ÊÄÅÊï∞ÁªÑ
 * 
 * Êï∞ÁªÑÁ¥¢ÂºïÂØπÂ∫îËôöÊãüÈîÆÁ†ÅÔºåÂÄºË°®Á§∫ËØ•ÈîÆÊòØÂê¶Ë¢´Êåâ‰∏ã„ÄÇ
 * - true: ÊåâÈîÆÊ≠£Âú®Ë¢´Êåâ‰∏ã
 * - false: ÊåâÈîÆÊú™Ë¢´Êåâ‰∏ã
 * 
 * üí° ‰∏∫‰ªÄ‰πàÁî® staticÔºü
 * - static ÂÖ≥ÈîÆÂ≠ó‰ΩøËøô‰∏™Êï∞ÁªÑÂè™Âú®Êú¨Êñá‰ª∂ÂÜÖÂèØËßÅÔºåÂ§ñÈÉ®Êó†Ê≥ïÁõ¥Êé•ËÆøÈóÆ
 * - ËøôÊòØ‰∏ÄÁßçÂ∞ÅË£ÖÊäÄÊúØÔºåÈò≤Ê≠¢Â§ñÈÉ®‰ª£Á†ÅÁõ¥Êé•‰øÆÊîπÊåâÈîÆÁä∂ÊÄÅ
 * - Â§ñÈÉ®Âè™ËÉΩÈÄöËøáÊèê‰æõÁöÑÂáΩÊï∞Êé•Âè£ËÆøÈóÆ
 */
static bool keyStates[256] = {false};

/* ============================================================================
 * ÊåâÈîÆÁä∂ÊÄÅËÆæÁΩÆÂáΩÊï∞ÂÆûÁé∞
 * ============================================================================
 */

/**
 * @brief Â§ÑÁêÜÊåâÈîÆÊåâ‰∏ã‰∫ã‰ª∂
 * 
 * ÂÆûÁé∞ËØ¥ÊòéÔºö
 * 1. ‰ªé wParam Ëé∑ÂèñËôöÊãüÈîÆÁ†Å
 * 2. Ê£ÄÊü•ÈîÆÁ†ÅÊòØÂê¶Âú®ÊúâÊïàËåÉÂõ¥ÂÜÖÔºà0-255Ôºâ
 * 3. Â∞ÜÂØπÂ∫îÁöÑÁä∂ÊÄÅËÆæÁΩÆ‰∏∫ true
 * 
 * üí° ‰∏∫‰ªÄ‰πàË¶ÅÊ£ÄÊü•ËåÉÂõ¥Ôºü
 * Èò≤Ê≠¢Êï∞ÁªÑË∂äÁïåÔºåËôΩÁÑ∂Ê≠£Â∏∏ÊÉÖÂÜµ‰∏ã‰∏ç‰ºöÂèëÁîüÔºå‰ΩÜËøôÊòØËâØÂ•ΩÁöÑÁºñÁ®ã‰π†ÊÉØ„ÄÇ
 */
void KeyDown(HWND hWnd, WPARAM wParam, LPARAM lParam)
{
    // wParam ÂåÖÂê´ËôöÊãüÈîÆÁ†Å
    int keycode = (int)wParam;
    
    // Ê£ÄÊü•ÈîÆÁ†ÅÊòØÂê¶Âú®ÊúâÊïàËåÉÂõ¥ÂÜÖ
    if (keycode >= 0 && keycode < 256)
    {
        keyStates[keycode] = true;
    }
    
    // üí° Ë∞ÉËØïÊäÄÂ∑ßÔºö
    // Â¶ÇÊûúÊÉ≥Êü•ÁúãÊåâ‰∏ã‰∫ÜÂì™‰∏™ÈîÆÔºåÂèØ‰ª•Ê∑ªÂä†Êó•ÂøóËæìÂá∫Ôºö
    // Log(1, TEXT("Key Down: %d"), keycode);
}

/**
 * @brief Â§ÑÁêÜÊåâÈîÆÈáäÊîæ‰∫ã‰ª∂
 * 
 * ÂÆûÁé∞ËØ¥ÊòéÔºö
 * ‰∏é KeyDown Á±ª‰ººÔºå‰ΩÜÂ∞ÜÁä∂ÊÄÅËÆæÁΩÆ‰∏∫ false
 */
void KeyUp(HWND hWnd, WPARAM wParam, LPARAM lParam)
{
    // wParam ÂåÖÂê´ËôöÊãüÈîÆÁ†Å
    int keycode = (int)wParam;
    
    // Ê£ÄÊü•ÈîÆÁ†ÅÊòØÂê¶Âú®ÊúâÊïàËåÉÂõ¥ÂÜÖ
    if (keycode >= 0 && keycode < 256)
    {
        keyStates[keycode] = false;
    }
    
    // üí° Ë∞ÉËØïÊäÄÂ∑ßÔºö
    // Log(1, TEXT("Key Up: %d"), keycode);
}

/* ============================================================================
 * ÊåâÈîÆÁä∂ÊÄÅÊü•ËØ¢ÂáΩÊï∞ÂÆûÁé∞
 * ============================================================================
 */

/**
 * @brief Ê£ÄÊü•ÊåáÂÆöÊåâÈîÆÊòØÂê¶Ê≠£Âú®Ë¢´Êåâ‰∏ã
 * 
 * ÂÆûÁé∞ËØ¥ÊòéÔºö
 * 1. Ê£ÄÊü•ÈîÆÁ†ÅÊòØÂê¶Âú®ÊúâÊïàËåÉÂõ¥ÂÜÖ
 * 2. ËøîÂõûÂØπÂ∫îÁöÑÁä∂ÊÄÅ
 * 3. Â¶ÇÊûúÈîÆÁ†ÅÊó†ÊïàÔºåËøîÂõû falseÔºàÂÆâÂÖ®ËøîÂõûÂÄºÔºâ
 * 
 * üí° ‰∏∫‰ªÄ‰πàËøôÊ†∑ÂÆûÁé∞Ôºü
 * - ÁÆÄÂçïÁõ¥Êé•ÔºåÊÄßËÉΩÊúÄ‰ºòÔºàO(1) Êó∂Èó¥Â§çÊùÇÂ∫¶Ôºâ
 * - ÂÆâÂÖ®ÔºöÊó†ÊïàÈîÆÁ†Å‰∏ç‰ºöÂØºËá¥Â¥©Ê∫É
 * - ÂèØÈù†ÔºöÁä∂ÊÄÅÁî± Windows Ê∂àÊÅØÈ©±Âä®ÔºåÂáÜÁ°ÆÂèçÊò†ÂÆûÈôÖÊåâÈîÆÁä∂ÊÄÅ
 */
bool GetKeyDown(int keycode)
{
    // Ê£ÄÊü•ÈîÆÁ†ÅÊòØÂê¶Âú®ÊúâÊïàËåÉÂõ¥ÂÜÖ
    if (keycode >= 0 && keycode < 256)
    {
        return keyStates[keycode];
    }
    
    // Êó†ÊïàÁöÑÈîÆÁ†ÅËøîÂõû false
    return false;
}

/* ============================================================================
 * ÂèØÈÄâÁöÑËæÖÂä©ÂáΩÊï∞ÔºàÂ¶ÇÊûúÈúÄË¶ÅÂèØ‰ª•Ê∑ªÂä†Ôºâ
 * ============================================================================
 */

/**
 * @brief Ê∏ÖÁ©∫ÊâÄÊúâÊåâÈîÆÁä∂ÊÄÅ
 * 
 * Áî®ÈÄîÔºö
 * - Á™óÂè£Â§±ÂéªÁÑ¶ÁÇπÊó∂ÔºåÊ∏ÖÁ©∫ÊåâÈîÆÁä∂ÊÄÅÈò≤Ê≠¢"Âç°‰Ωè"
 * - Âú∫ÊôØÂàáÊç¢Êó∂ÔºåÈáçÁΩÆËæìÂÖ•Áä∂ÊÄÅ
 * 
 * Ë∞ÉÁî®Êó∂Êú∫ÔºàÂú® WndProc ‰∏≠ÔºâÔºö
 * ```cpp
 * case WM_KILLFOCUS:  // Á™óÂè£Â§±ÂéªÁÑ¶ÁÇπ
 *     ClearKeyStates();
 *     break;
 * ```
 * 
 * üí° ‰∏∫‰ªÄ‰πàË¶ÅËøô‰∏™ÂáΩÊï∞Ôºü
 * ÂÅáËÆæÂú∫ÊôØÔºö
 * 1. Áé©ÂÆ∂Êåâ‰∏ã W ÈîÆÔºàÂêë‰∏äÁßªÂä®Ôºâ
 * 2. ÂàáÊç¢Âà∞Âè¶‰∏Ä‰∏™Á™óÂè£ÔºàÊ∏∏ÊàèÁ™óÂè£Â§±ÂéªÁÑ¶ÁÇπÔºâ
 * 3. ÈáäÊîæ W ÈîÆÔºà‰ΩÜÊ∏∏ÊàèÊ≤°ÊúâÊî∂Âà∞ WM_KEYUP Ê∂àÊÅØÔºâ
 * 4. ÂàáÂõûÊ∏∏ÊàèÁ™óÂè£
 * 5. ÁªìÊûúÔºöÊ∏∏ÊàèËÆ§‰∏∫ W ÈîÆËøòÂú®Ë¢´Êåâ‰∏ãÔºåÁé©ÂÆ∂ËßíËâ≤‰∏ÄÁõ¥Âêë‰∏äÁßªÂä®
 * 
 * Ëß£ÂÜ≥ÊñπÊ≥ïÔºöÂ§±ÂéªÁÑ¶ÁÇπÊó∂Ê∏ÖÁ©∫ÊâÄÊúâÊåâÈîÆÁä∂ÊÄÅ
 */
void ClearKeyStates()
{
    // Â∞ÜÊâÄÊúâÊåâÈîÆÁä∂ÊÄÅËÆæÁΩÆ‰∏∫ false
    for (int i = 0; i < 256; i++)
    {
        keyStates[i] = false;
    }
}

/* ============================================================================
 * ËøõÈò∂ÂäüËÉΩÂÆûÁé∞Á§∫‰æãÔºàÂèØÈÄâÔºâ
 * ============================================================================
 * 
 * ‰ª•‰∏ãÊòØ‰∏Ä‰∫õËøõÈò∂ÂäüËÉΩÁöÑÂÆûÁé∞ÊÄùË∑ØÔºåÂàùÂ≠¶ËÄÖÂèØ‰ª•Ë∑≥Ëøá„ÄÇ
 * 
 * 1. Ê£ÄÊµãÊåâÈîÆ"Êåâ‰∏ãÁû¨Èó¥"Ôºö
 * 
 * ```cpp
 * // ÈúÄË¶Å‰øùÂ≠ò‰∏ä‰∏ÄÂ∏ßÁöÑÊåâÈîÆÁä∂ÊÄÅ
 * static bool prevKeyStates[256] = {false};
 * 
 * // ÊØèÂ∏ßÁªìÊùüÊó∂Ë∞ÉÁî®Ôºå‰øùÂ≠òÂΩìÂâçÁä∂ÊÄÅ
 * void UpdateKeyStates()
 * {
 *     for (int i = 0; i < 256; i++)
 *     {
 *         prevKeyStates[i] = keyStates[i];
 *     }
 * }
 * 
 * // Ê£ÄÊµãÊåâÈîÆÊòØÂê¶Âú®Ëøô‰∏ÄÂ∏ßË¢´Êåâ‰∏ãÔºàÂè™Âú®Êåâ‰∏ãÁû¨Èó¥ËøîÂõû trueÔºâ
 * bool GetKeyPressed(int keycode)
 * {
 *     if (keycode >= 0 && keycode < 256)
 *     {
 *         // ÂΩìÂâçÂ∏ßÊåâ‰∏ãÔºå‰∏î‰∏ä‰∏ÄÂ∏ßÊú™Êåâ‰∏ã
 *         return keyStates[keycode] && !prevKeyStates[keycode];
 *     }
 *     return false;
 * }
 * 
 * // Ê£ÄÊµãÊåâÈîÆÊòØÂê¶Âú®Ëøô‰∏ÄÂ∏ßË¢´ÈáäÊîæ
 * bool GetKeyReleased(int keycode)
 * {
 *     if (keycode >= 0 && keycode < 256)
 *     {
 *         // ÂΩìÂâçÂ∏ßÊú™Êåâ‰∏ãÔºå‰ΩÜ‰∏ä‰∏ÄÂ∏ßÊåâ‰∏ã
 *         return !keyStates[keycode] && prevKeyStates[keycode];
 *     }
 *     return false;
 * }
 * ```
 * 
 * ‰ΩøÁî®Âú∫ÊôØÔºö
 * - ËèúÂçïÈÄâÊã©ÔºàÊåâ‰∏ÄÊ¨°ÂàáÊç¢‰∏ÄÈ°πÔºåËÄå‰∏çÊòØÊåÅÁª≠ÂàáÊç¢Ôºâ
 * - ÂºÄÊû™Â∞ÑÂáªÔºàÂçïÂèëÊ®°ÂºèÔºåÊåâ‰∏ÄÊ¨°Â∞Ñ‰∏ÄÂèëÔºâ
 * - Ë∑≥Ë∑ÉÔºàÊåâ‰∏ÄÊ¨°Ë∑≥‰∏ÄÊ¨°ÔºåËÄå‰∏çÊòØÊåÅÁª≠Ë∑≥Ôºâ
 * 
 * 2. ÁªÑÂêàÈîÆÊ£ÄÊµãÔºö
 * 
 * ```cpp
 * bool IsComboPressed(int key1, int key2)
 * {
 *     return GetKeyDown(key1) && GetKeyDown(key2);
 * }
 * 
 * // ‰ΩøÁî®Á§∫‰æãÔºö
 * if (IsComboPressed(VK_CONTROL, 'S'))
 * {
 *     SaveGame();
 * }
 * ```
 * 
 * 3. ÊåâÈîÆÊò†Â∞ÑÁ≥ªÁªüÔºö
 * 
 * ```cpp
 * // ÂÆö‰πâÊ∏∏ÊàèÂä®‰ΩúÊûö‰∏æ
 * enum GameAction
 * {
 *     ACTION_MOVE_UP,
 *     ACTION_MOVE_DOWN,
 *     ACTION_MOVE_LEFT,
 *     ACTION_MOVE_RIGHT,
 *     ACTION_SHOOT,
 *     ACTION_PAUSE,
 *     ACTION_COUNT
 * };
 * 
 * // Âä®‰ΩúÂà∞ÈîÆÁ†ÅÁöÑÊò†Â∞Ñ
 * static int actionKeyMap[ACTION_COUNT] = {
 *     'W',        // ACTION_MOVE_UP
 *     'S',        // ACTION_MOVE_DOWN
 *     'A',        // ACTION_MOVE_LEFT
 *     'D',        // ACTION_MOVE_RIGHT
 *     VK_SPACE,   // ACTION_SHOOT
 *     VK_ESCAPE   // ACTION_PAUSE
 * };
 * 
 * // ËÆæÁΩÆÊåâÈîÆÊò†Â∞Ñ
 * void SetActionKey(GameAction action, int keycode)
 * {
 *     if (action >= 0 && action < ACTION_COUNT)
 *     {
 *         actionKeyMap[action] = keycode;
 *     }
 * }
 * 
 * // Ê£ÄÊµãÂä®‰ΩúÊòØÂê¶Ëß¶Âèë
 * bool IsActionPressed(GameAction action)
 * {
 *     if (action >= 0 && action < ACTION_COUNT)
 *     {
 *         return GetKeyDown(actionKeyMap[action]);
 *     }
 *     return false;
 * }
 * 
 * // ‰ΩøÁî®Á§∫‰æãÔºö
 * if (IsActionPressed(ACTION_SHOOT))
 * {
 *     FireBullet();
 * }
 * ```
 * 
 * Â•ΩÂ§ÑÔºö
 * - Áé©ÂÆ∂ÂèØ‰ª•Ëá™ÂÆö‰πâÊåâÈîÆ
 * - ‰ª£Á†ÅÊõ¥Ê∏ÖÊô∞Ôºà‰ΩøÁî®Âä®‰ΩúÂêçËÄå‰∏çÊòØÈîÆÁ†ÅÔºâ
 * - ÊîØÊåÅÂ§öÂ•óÊåâÈîÆÊñπÊ°àÔºàWASD / ÊñπÂêëÈîÆÔºâ
 * 
 * ============================================================================
 */

/* ============================================================================
 * ‰ΩøÁî®Á§∫‰æã
 * ============================================================================
 * 
 * Á§∫‰æã 1ÔºöÂú® WndProc ‰∏≠ËÆæÁΩÆÊåâÈîÆÁä∂ÊÄÅ
 * 
 * ```cpp
 * LRESULT CALLBACK WndProc(HWND hWnd, UINT message, WPARAM wParam, LPARAM lParam)
 * {
 *     switch (message)
 *     {
 *     case WM_KEYDOWN:
 *         KeyDown(hWnd, wParam, lParam);
 *         break;
 *         
 *     case WM_KEYUP:
 *         KeyUp(hWnd, wParam, lParam);
 *         break;
 *         
 *     case WM_KILLFOCUS:
 *         ClearKeyStates();  // Â§±ÂéªÁÑ¶ÁÇπÊó∂Ê∏ÖÁ©∫Áä∂ÊÄÅ
 *         break;
 *         
 *     // ÂÖ∂‰ªñÊ∂àÊÅØÂ§ÑÁêÜ...
 *     }
 *     return DefWindowProc(hWnd, message, wParam, lParam);
 * }
 * ```
 * 
 * Á§∫‰æã 2ÔºöÂú®Ê∏∏ÊàèÈÄªËæë‰∏≠‰ΩøÁî®ÈîÆÁõòËæìÂÖ•
 * 
 * ```cpp
 * void UpdatePlayer(double deltaTime)
 * {
 *     Player* player = GetPlayer();
 *     
 *     // 1. Ëé∑ÂèñËæìÂÖ•ÊñπÂêë
 *     Vector2 direction = {0, 0};
 *     
 *     if (GetKeyDown('W') || GetKeyDown(VK_UP))
 *         direction.y -= 1;
 *     if (GetKeyDown('S') || GetKeyDown(VK_DOWN))
 *         direction.y += 1;
 *     if (GetKeyDown('A') || GetKeyDown(VK_LEFT))
 *         direction.x -= 1;
 *     if (GetKeyDown('D') || GetKeyDown(VK_RIGHT))
 *         direction.x += 1;
 *     
 *     // 2. ÂΩí‰∏ÄÂåñÊñπÂêëÔºà‰øùËØÅÊâÄÊúâÊñπÂêëÈÄüÂ∫¶‰∏ÄËá¥Ôºâ
 *     direction = Normalize(direction);
 *     
 *     // 3. ÁßªÂä®Áé©ÂÆ∂
 *     player->position.x += direction.x * player->speed * deltaTime;
 *     player->position.y += direction.y * player->speed * deltaTime;
 *     
 *     // 4. ÈôêÂà∂Âú®Â±èÂπïÂÜÖ
 *     player->position.x = Clamp(player->position.x, 0, GAME_WIDTH - player->width);
 *     player->position.y = Clamp(player->position.y, 0, GAME_HEIGHT - player->height);
 *     
 *     // 5. ÂèëÂ∞ÑÂ≠êÂºπ
 *     if (GetKeyDown(VK_SPACE))
 *     {
 *         // Ê£ÄÊü•ÂÜ∑Âç¥Êó∂Èó¥
 *         if (player->bulletCd <= 0)
 *         {
 *             FireBullet();
 *             player->bulletCd = player->maxBulletCd;
 *         }
 *     }
 *     
 *     // 6. ÊöÇÂÅúÊ∏∏Êàè
 *     if (GetKeyDown(VK_ESCAPE))
 *     {
 *         PauseGame();
 *     }
 * }
 * ```
 * 
 * ============================================================================
 */
